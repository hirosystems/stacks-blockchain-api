/* eslint-disable @typescript-eslint/no-unsafe-return */
/* eslint-disable prettier/prettier */
import { clarityValueToCompactJson } from '../helpers';
import { decodeClarityValueToRepr } from 'stacks-encoding-native-js';

describe('clarity value compact json encoding', () => {

  const clarityCompactJsonVectors: [repr: string, hexEncodedCV: string, compactJson: string][] = [
    [
      `(tuple (action "voted") (data (tuple (contract 'SP3MBWGMCVC9KZ5DTAYFMG1D0AEJCR7NENTM3FTK5.proposal-farm-xusd-usda) (end-block-height u98088) (is-ended false) (no-votes u0) (proposer 'SP3MBWGMCVC9KZ5DTAYFMG1D0AEJCR7NENTM3FTK5) (start-block-height u97080) (title u"xUSD/USDA Farming at Arkadiko") (url u"https://discord.com/channels/923585641554518026/934026731256422450") (yes-votes u14965111242))) (type "proposal"))`,
      '0x0c0000000306616374696f6e0d00000005766f74656404646174610c0000000908636f6e74726163740616e8be428cdb133f95ba579f4805a053a4cc1eaeae1770726f706f73616c2d6661726d2d787573642d7573646110656e642d626c6f636b2d6865696768740100000000000000000000000000017f280869732d656e64656404086e6f2d766f74657301000000000000000000000000000000000870726f706f7365720516e8be428cdb133f95ba579f4805a053a4cc1eaeae1273746172742d626c6f636b2d6865696768740100000000000000000000000000017b38057469746c650e0000001d785553442f55534441204661726d696e672061742041726b6164696b6f0375726c0e0000004268747470733a2f2f646973636f72642e636f6d2f6368616e6e656c732f3932333538353634313535343531383032362f393334303236373331323536343232343530097965732d766f746573010000000000000000000000037bfd79ca04747970650d0000000870726f706f73616c',
      '{"action":"voted","data":{"contract":"SP3MBWGMCVC9KZ5DTAYFMG1D0AEJCR7NENTM3FTK5.proposal-farm-xusd-usda","end-block-height":98088,"is-ended":false,"no-votes":0,"proposer":"SP3MBWGMCVC9KZ5DTAYFMG1D0AEJCR7NENTM3FTK5","start-block-height":97080,"title":"xUSD/USDA Farming at Arkadiko","url":"https://discord.com/channels/923585641554518026/934026731256422450","yes-votes":14965111242},"type":"proposal"}'
    ],
    [
      `(tuple (action "accept-bid") (payload (tuple (action_event_index u1) (bid_amount u22000000) (bid_id u4572) (bidder_address 'SP1JSDAGAYXCTGVMNTD3H2RHP8XYTFR9Q813TPZK8) (collection_id 'SPJW1XE278YMCEYMXB8ZFGJMH8ZVAAEDP2S2PJYG.happy-welsh) (expiration_block u97322) (royalty (tuple (percent u250) (recipient_address 'SP28W4CM7T6RYGXHDA0BQPBYNKYSTSFCP0M6FJB0T))) (seller_address 'SP1NGMS9Z48PRXFAG2MKBSP0PWERF07C0KV9SPJ66) (token_id u907))))`,
      '0x0c0000000206616374696f6e0d0000000a6163636570742d626964077061796c6f61640c0000000912616374696f6e5f6576656e745f696e64657801000000000000000000000000000000010a6269645f616d6f756e7401000000000000000000000000014fb180066269645f696401000000000000000000000000000011dc0e6269646465725f6164647265737305166596aa0af759a86e95d347116236477da7e137400d636f6c6c656374696f6e5f6964061625c0f5c23a3d463bd4ead1f7c2548a3fb529cdb00b68617070792d77656c73681065787069726174696f6e5f626c6f636b0100000000000000000000000000017c2a07726f79616c74790c000000020770657263656e7401000000000000000000000000000000fa11726563697069656e745f61646472657373051691c23287d1b1e8762d50177b2fd59fb3acbd96050e73656c6c65725f6164647265737305166b0a653f222d8ebd501526bcd816e3b0f01d809e08746f6b656e5f6964010000000000000000000000000000038b',
      '{"action":"accept-bid","payload":{"action_event_index":1,"bid_amount":22000000,"bid_id":4572,"bidder_address":"SP1JSDAGAYXCTGVMNTD3H2RHP8XYTFR9Q813TPZK8","collection_id":"SPJW1XE278YMCEYMXB8ZFGJMH8ZVAAEDP2S2PJYG.happy-welsh","expiration_block":97322,"royalty":{"percent":250,"recipient_address":"SP28W4CM7T6RYGXHDA0BQPBYNKYSTSFCP0M6FJB0T"},"seller_address":"SP1NGMS9Z48PRXFAG2MKBSP0PWERF07C0KV9SPJ66","token_id":907}}'
    ],
    [
      `(tuple (action "swap-x-for-y") (data (tuple (balance-x u315175871745570) (balance-y u11937495544) (fee-rate-x u300000) (fee-rate-y u300000) (fee-rebate u50000000) (fee-to-address 'SP3K8BC0PPEVCV7NZ6QSRWPQ2JE9E5B6N3PA0KBR9.multisig-fwp-wstx-wbtc-50-50-v1-01) (oracle-average u95000000) (oracle-enabled true) (oracle-resilient u3871) (pool-token 'SP3K8BC0PPEVCV7NZ6QSRWPQ2JE9E5B6N3PA0KBR9.fwp-wstx-wbtc-50-50-v1-01) (total-supply u3290909475111))) (object "pool"))`,
      '0x0c0000000306616374696f6e0d0000000c737761702d782d666f722d7904646174610c0000000b0962616c616e63652d7801000000000000000000011ea699e08e220962616c616e63652d7901000000000000000000000002c787b9f80a6665652d726174652d7801000000000000000000000000000493e00a6665652d726174652d7901000000000000000000000000000493e00a6665652d7265626174650100000000000000000000000002faf0800e6665652d746f2d616464726573730616e685b016b3b6cd9ebf35f38e5ae29392e2acd51d226d756c74697369672d6677702d777374782d776274632d35302d35302d76312d30310e6f7261636c652d617665726167650100000000000000000000000005a995c00e6f7261636c652d656e61626c656403106f7261636c652d726573696c69656e740100000000000000000000000000000f1f0a706f6f6c2d746f6b656e0616e685b016b3b6cd9ebf35f38e5ae29392e2acd51d196677702d777374782d776274632d35302d35302d76312d30310c746f74616c2d737570706c79010000000000000000000002fe397d8127066f626a6563740d00000004706f6f6c',
      '{"action":"swap-x-for-y","data":{"balance-x":315175871745570,"balance-y":11937495544,"fee-rate-x":300000,"fee-rate-y":300000,"fee-rebate":50000000,"fee-to-address":"SP3K8BC0PPEVCV7NZ6QSRWPQ2JE9E5B6N3PA0KBR9.multisig-fwp-wstx-wbtc-50-50-v1-01","oracle-average":95000000,"oracle-enabled":true,"oracle-resilient":3871,"pool-token":"SP3K8BC0PPEVCV7NZ6QSRWPQ2JE9E5B6N3PA0KBR9.fwp-wstx-wbtc-50-50-v1-01","total-supply":3290909475111},"object":"pool"}'
    ],
    [
      `(tuple (action "swap-x-for-y") (data (tuple (balance-x u39248987199) (balance-y u294901858687020) (enabled true) (fee-balance-x u209257577) (fee-balance-y u3188281977630) (fee-to-address (some 'SP2C2YFP12AJZB4MABJBAJ55XECVS7E4PMMZ89YZR)) (name "wSTX-WELSH") (shares-total u3135066566725) (swap-token 'SP2C2YFP12AJZB4MABJBAJ55XECVS7E4PMMZ89YZR.arkadiko-swap-token-wstx-welsh))) (object "pair"))`,
      '0x0c0000000306616374696f6e0d0000000c737761702d782d666f722d7904646174610c000000090962616c616e63652d7801000000000000000000000009236c043f0962616c616e63652d7901000000000000000000010c363087d82c07656e61626c6564030d6665652d62616c616e63652d78010000000000000000000000000c7904690d6665652d62616c616e63652d79010000000000000000000002e6546a2b1e0e6665652d746f2d616464726573730a0516982f3ec112a5f5928a5c96a914bd733793b896a5046e616d650d0000000a775354582d57454c53480c7368617265732d746f74616c010000000000000000000002d9f08770450a737761702d746f6b656e0616982f3ec112a5f5928a5c96a914bd733793b896a51e61726b6164696b6f2d737761702d746f6b656e2d777374782d77656c7368066f626a6563740d0000000470616972',
      '{"action":"swap-x-for-y","data":{"balance-x":39248987199,"balance-y":294901858687020,"enabled":true,"fee-balance-x":209257577,"fee-balance-y":3188281977630,"fee-to-address":"SP2C2YFP12AJZB4MABJBAJ55XECVS7E4PMMZ89YZR","name":"wSTX-WELSH","shares-total":3135066566725,"swap-token":"SP2C2YFP12AJZB4MABJBAJ55XECVS7E4PMMZ89YZR.arkadiko-swap-token-wstx-welsh"},"object":"pair"}'
    ],
    [
      `(tuple (attachment (tuple (attachment-index u360918) (hash 0xffcbf70fa7fa89adcbd4d80530d2cc93a3f1d236) (metadata (tuple (name 0x64657369676e6d616e6167656d656e74636f6e73756c74696e67) (namespace 0x627463) (op "name-register") (tx-sender 'SP3JH2C1BW3TY23AW5X12TPBFMSZHTV0TBZ1KH5S9))))))`,
      '0x0c000000010a6174746163686d656e740c00000003106174746163686d656e742d696e64657801000000000000000000000000000581d604686173680200000014ffcbf70fa7fa89adcbd4d80530d2cc93a3f1d236086d657461646174610c00000004046e616d65020000001a64657369676e6d616e6167656d656e74636f6e73756c74696e67096e616d6573706163650200000003627463026f700d0000000d6e616d652d72656769737465720974782d73656e6465720516e511302be0f5e10d5c2f422d596fa67f1d6c1a5f',
      '{"attachment":{"attachment-index":360918,"hash":{"hex":"0xffcbf70fa7fa89adcbd4d80530d2cc93a3f1d236","utf8":"���\\u000f�������\\u00050�̓���6"},"metadata":{"name":{"hex":"0x64657369676e6d616e6167656d656e74636f6e73756c74696e67","utf8":"designmanagementconsulting"},"namespace":{"hex":"0x627463","utf8":"btc"},"op":"name-register","tx-sender":"SP3JH2C1BW3TY23AW5X12TPBFMSZHTV0TBZ1KH5S9"}}}'
    ],
    [
      `(tuple (amountStacked u7420000000000) (cityId u1) (cityName "mia") (cityTreasury 'SP8A9HZ3PKST0S42VM9523Z9NV42SZ026V4K39WH.ccd002-treasury-mia-stacking) (event "stacking") (firstCycle u54) (lastCycle u59) (lockPeriod u6) (userId u136))`,
      '0x0c000000090d616d6f756e74537461636b6564010000000000000000000006bf9a76d80006636974794964010000000000000000000000000000000108636974794e616d650d000000036d69610c636974795472656173757279061610a4c7e3b4f3a06482dd12510fe9aec82cfc02361c6363643030322d74726561737572792d6d69612d737461636b696e67056576656e740d00000008737461636b696e670a66697273744379636c650100000000000000000000000000000036096c6173744379636c65010000000000000000000000000000003b0a6c6f636b506572696f640100000000000000000000000000000006067573657249640100000000000000000000000000000088',
      '{"amountStacked":7420000000000,"cityId":1,"cityName":"mia","cityTreasury":"SP8A9HZ3PKST0S42VM9523Z9NV42SZ026V4K39WH.ccd002-treasury-mia-stacking","event":"stacking","firstCycle":54,"lastCycle":59,"lockPeriod":6,"userId":136}'
    ],
    [
      '0x3231333431363630323537',
      '0x020000000b3231333431363630323537',
      '{"hex":"0x3231333431363630323537","utf8":"21341660257"}'
    ],
    [
      'none',
      '0x09',
      'null'
    ],
    [
      '"``... to be a completely separate network and separate block chain, yet share CPU power with Bitcoin`` - Satoshi Nakamoto"',
      '0x0d0000007960602e2e2e20746f206265206120636f6d706c6574656c79207365706172617465206e6574776f726b20616e6420736570617261746520626c6f636b20636861696e2c207965742073686172652043505520706f776572207769746820426974636f696e6060202d205361746f736869204e616b616d6f746f',
      '"``... to be a completely separate network and separate block chain, yet share CPU power with Bitcoin`` - Satoshi Nakamoto"'
    ],
    [
      "'SP1K1A1PMGW2ZJCNF46NWZWHG8TS1D23EGH1KNK60",
      '0x0516661506d48705f932af21abcff23046b216886e84',
      '"SP1K1A1PMGW2ZJCNF46NWZWHG8TS1D23EGH1KNK60"'
    ],
    [
      '"Is this thing on?"',
      '0x0d0000001149732074686973207468696e67206f6e3f',
      '"Is this thing on?"'
    ],
    [
      '0x324d775773533233676638346554',
      '0x020000000e324d775773533233676638346554',
      '{"hex":"0x324d775773533233676638346554","utf8":"2MwWsS23gf84eT"}'
    ]
  ];

  test.each(clarityCompactJsonVectors)('test Clarity value compact json encoding: %p', (reprString, hexEncodedCV, compactJson) => {
    const encodedJson = clarityValueToCompactJson(hexEncodedCV);
    const reprResult = decodeClarityValueToRepr(hexEncodedCV);
    expect(encodedJson).toEqual(JSON.parse(compactJson));
    expect(reprResult).toBe(reprString);
  });

  /*
  test.skip('generate', () => {
    const result = clarityCompactJsonVectors.map(([, hexEncodedCV, compactJson]) => {
      const encodedJson = clarityValueToCompactJson(hexEncodedCV);
      const reprResult = decodeClarityValueToRepr(hexEncodedCV);
      return [reprResult, hexEncodedCV, JSON.stringify(encodedJson)];
    });
    console.log(result);
  });
  */

});
